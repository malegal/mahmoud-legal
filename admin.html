<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
:root{ --gold:#D4AF37; --black:#1A1A1A; --bg:#F8F5E6; }
body{background:var(--bg);font-family:Segoe UI}
.header{background:linear-gradient(135deg,#000,#333);color:var(--gold);padding:20px;border-bottom:4px solid var(--gold)}
.form-section{background:#fff;border-radius:8px;padding:20px;margin-bottom:20px;border-right:5px solid var(--gold);box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
.btn-gold{background:var(--gold);border:none;font-weight:600;color:#fff}
.btn-gold:hover{background:#b8962e;color:#fff}
.session-card{background:#fff;border-right:4px solid var(--gold);padding:15px;margin-bottom:10px;border-radius:4px;box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
.case-code{font-family:monospace;font-size:1.2rem;color:var(--gold);font-weight:bold}
.nav-tabs .nav-link.active {background-color: var(--gold); color: white; border-color: var(--gold);}
.nav-tabs .nav-link {color: var(--black);}
.auto-fill-badge { font-size: 0.7rem; background: #e9ecef; padding: 2px 8px; border-radius: 10px; color: #666; }
.detail-label { font-weight: bold; color: #555; font-size: 0.9rem; }
</style>
</head>

<body>

<div id="loginPage" class="container mt-5" style="max-width:400px">
<div class="form-section text-center">
<i class="bi bi-shield-lock-fill" style="font-size: 3rem; color: var(--gold);"></i>
<h4 class="mt-3">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
<input type="password" id="password" class="form-control my-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="btn btn-gold w-100" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>
</div>

<div id="mainContent" style="display:none">
<div class="header text-center">
<h2>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</h2>
<p id="today"></p>
</div>

<div class="container mt-4">
<ul class="nav nav-tabs mb-3" id="mainTabs">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#cases">Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#sessions">Ø§Ù„Ø¬Ù„Ø³Ø§Øª</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#search">Ø¨Ø­Ø« ÙˆØªÙ‚Ø§Ø±ÙŠØ±</button></li>
</ul>

<div class="tab-content">
<div class="tab-pane fade show active" id="cases">
<form id="caseForm" class="form-section">
<h5>ØªØ³Ø¬ÙŠÙ„ Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h5>
<hr>
<div class="row g-3">
<div class="col-md-4"><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input id="client_name" class="form-control" required></div>
<div class="col-md-4"><label>Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input id="client_phone" class="form-control" required></div>
<div class="col-md-4">
    <label>ØµÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
    <select id="client_role" class="form-select" required>
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙØ©...</option>
        <option>Ù…Ø¯Ø¹ÙŠ</option><option>Ù…Ø¯Ø¹Ù‰ Ø¹Ù„ÙŠÙ‡</option><option>Ù…Ø¬Ù†ÙŠ Ø¹Ù„ÙŠÙ‡</option><option>Ù…ØªÙ‡Ù…</option>
        <option>Ø·Ø§Ø¹Ù†</option><option>Ù…Ø·Ø¹ÙˆÙ† Ø¶Ø¯Ù‡</option><option>Ù…Ø³ØªØ£Ù†Ù</option><option>Ù…Ø³ØªØ£Ù†Ù Ø¶Ø¯Ù‡</option>
    </select>
</div>
<div class="col-md-4"><label>Ø§Ø³Ù… Ø§Ù„Ø®ØµÙ…</label><input id="opponent_name" class="form-control"></div>
<div class="col-md-4"><label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</label><input id="case_number" class="form-control" required></div>
<div class="col-md-4"><label>Ø³Ù†Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</label><input id="case_year" class="form-control" required></div>
<div class="col-md-6">
    <label>Ø§Ù„Ù…Ø­ÙƒÙ…Ø©</label>
    <select id="court_name" class="form-select" required>
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙƒÙ…Ø©...</option>
        <option>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø©</option><option>Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</option><option>Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</option>
        <option>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù</option><option>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ù†Ù‚Ø¶</option><option>Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¯ÙˆÙ„Ø©</option>
    </select>
</div>
<div class="col-md-6"><label>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</label><input id="circle" class="form-control"></div>
<div class="col-md-6">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
    <select id="case_type" class="form-select">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
        <option>Ù…Ø¯Ù†ÙŠ</option><option>Ø¬Ù†Ø§Ø¦ÙŠ</option><option>Ø£Ø³Ø±Ø©</option><option>Ø¹Ù…Ø§Ù„ÙŠ</option><option>ØªØ¬Ø§Ø±ÙŠ</option><option>Ø¥Ø¯Ø§Ø±ÙŠ</option>
    </select>
</div>
<div class="col-md-6">
    <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
    <select id="case_status" class="form-select">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©...</option>
        <option>Ù…ØªØ¯Ø§ÙˆÙ„Ø©</option><option>Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ù„Ø­ÙƒÙ…</option><option>Ù…Ù†ØªÙ‡ÙŠØ©</option><option>Ù…Ø´Ø·ÙˆØ¨Ø©</option><option>Ù…ÙˆÙ‚ÙˆÙØ©</option>
    </select>
</div>
<div class="col-md-12"><label>Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©</label><textarea id="case_subject" class="form-control" rows="2"></textarea></div>
<div class="col-md-12"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea id="notes" class="form-control" rows="2"></textarea></div>
</div>
<button type="submit" class="btn btn-gold w-100 mt-3">Ø­ÙØ¸ Ø§Ù„Ù‚Ø¶ÙŠØ©</button>
<div id="caseCodeResult" class="mt-3 text-center"></div>
</form>
</div>

<div class="tab-pane fade" id="sessions">
<div class="form-section">
<h5>ØªØ³Ø¬ÙŠÙ„ Ø¬Ù„Ø³Ø© <span class="auto-fill-badge">Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ© ÙˆØ§Ù„Ø³Ù†Ø© ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span></h5>
<hr>
<div class="row g-3">
<div class="col-md-3"><label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</label><input id="s_case_number" class="form-control" onchange="autoFillCase()"></div>
<div class="col-md-3"><label>Ø³Ù†Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</label><input id="s_case_year" class="form-control" onchange="autoFillCase()"></div>
<div class="col-md-6"><label>Ø§Ù„Ù…Ø­ÙƒÙ…Ø©</label><input id="s_court" class="form-control" readonly></div>
<div class="col-md-6"><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input id="s_client" class="form-control" readonly></div>
<div class="col-md-6"><label>Ø§Ø³Ù… Ø§Ù„Ø®ØµÙ…</label><input id="s_opponent" class="form-control" readonly></div>
<div class="col-md-6"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©</label><input type="date" id="s_date" class="form-control"></div>
<div class="col-md-12"><label>Ø§Ù„Ù‚Ø±Ø§Ø±</label><textarea id="s_decision" class="form-control"></textarea></div>
</div>
<button class="btn btn-gold w-100 mt-3" onclick="saveSession()">Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
</div>

<div class="form-section">
<h5>Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©</h5>
<div class="row g-2 mb-3">
    <div class="col-md-5"><label class="small">Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" id="s_filter_from" class="form-control"></div>
    <div class="col-md-5"><label class="small">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" id="s_filter_to" class="form-control"></div>
    <div class="col-md-2 d-flex align-items-end"><button class="btn btn-dark w-100" onclick="loadUpcomingByRange()"><i class="bi bi-search"></i></button></div>
</div>
<div id="upcomingSessions"></div>
</div>
</div>

<div class="tab-pane fade" id="search">
<div class="form-section">
    <h5>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h5>
    <hr>
    <div class="row g-2 mb-3">
        <div class="col-md-8"><input id="searchInput" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©ØŒ Ø§Ù„Ø³Ù†Ø©ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©"></div>
        <div class="col-md-4"><button class="btn btn-gold w-100" onclick="searchCases()">Ø¨Ø­Ø« Ø¹Ø§Ù…</button></div>
    </div>
    <div class="p-3 border rounded bg-light">
        <h6>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø®Ù„Ø§Ù„ ÙØªØ±Ø©:</h6>
        <div class="row g-2">
            <div class="col-md-5"><label class="small">Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" id="date_from" class="form-control"></div>
            <div class="col-md-5"><label class="small">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" id="date_to" class="form-control"></div>
            <div class="col-md-2 d-flex align-items-end"><button class="btn btn-dark w-100" onclick="filterByDateRange()"><i class="bi bi-filter"></i></button></div>
        </div>
    </div>
</div>
<div id="searchResults"></div>
</div>
</div>
</div>
</div>

<script>
const SB_URL="https://iyhfafodhptcdwrjywek.supabase.co";
const SB_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5aGZhZm9kaHB0Y2R3cmp5d2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMzUzODYsImV4cCI6MjA4MjcxMTM4Nn0.YmeMSDkQ3Z_vpyMTyZ-3jbKLFzVZzwcLeDsdczrErHQ";
const db=supabase.createClient(SB_URL,SB_KEY);

let currentCaseId = null;

function login(){
    if(document.getElementById('password').value==="mahmoud237"){
        loginPage.style.display="none"; mainContent.style.display="block";
        today.innerText=new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const todayStr = new Date().toISOString().split('T')[0];
        document.getElementById('s_filter_from').value = todayStr;
        document.getElementById('s_filter_to').value = todayStr;
        loadUpcomingByRange();
    } else Swal.fire("Ø®Ø·Ø£","ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©","error");
}

async function autoFillCase() {
    const num = document.getElementById('s_case_number').value;
    const year = document.getElementById('s_case_year').value;
    if(num && year) {
        const { data, error } = await db.from('cases').select('*').eq('case_number', num).eq('case_year', year).maybeSingle();
        if(data) {
            currentCaseId = data.id;
            document.getElementById('s_court').value = data.court_name;
            document.getElementById('s_client').value = data.client_name;
            document.getElementById('s_opponent').value = data.opponent_name;
            Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', showConfirmButton: false, timer: 1000 });
        } else {
            currentCaseId = null;
            ['s_court','s_client','s_opponent'].forEach(id=>document.getElementById(id).value="");
        }
    }
}

caseForm.onsubmit=async e=>{
    e.preventDefault();
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
    const code=`MA-${Date.now().toString().slice(-6)}`;
    const { error } = await db.from('cases').insert([{
        client_name: document.getElementById('client_name').value,
        client_phone: document.getElementById('client_phone').value,
        client_role: document.getElementById('client_role').value,
        opponent_name: document.getElementById('opponent_name').value,
        case_number: document.getElementById('case_number').value,
        case_year: document.getElementById('case_year').value,
        court_name: document.getElementById('court_name').value,
        circle: document.getElementById('circle').value,
        case_type: document.getElementById('case_type').value,
        case_status: document.getElementById('case_status').value,
        case_subject: document.getElementById('case_subject').value,
        notes: document.getElementById('notes').value,
        case_code: code
    }]);
    if(error) Swal.fire("Ø®Ø·Ø£", error.message, "error");
    else { Swal.fire("ØªÙ…", `Ø§Ù„ÙƒÙˆØ¯: ${code}`, "success"); caseForm.reset(); }
};

async function saveSession(){
    if(!currentCaseId) return Swal.fire("ØªÙ†Ø¨ÙŠÙ‡","Ø§Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¶ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹","warning");
    const sDate = document.getElementById('s_date').value;
    if(!sDate) return Swal.fire("ØªÙ†Ø¨ÙŠÙ‡","Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®","warning");
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
    const { error } = await db.from('sessions').insert([{ case_id: currentCaseId, session_date: sDate, decision: document.getElementById('s_decision').value }]);
    if(error) Swal.fire("Ø®Ø·Ø£", error.message, "error");
    else { Swal.fire("ØªÙ…", "Ø­ÙØ¸Øª Ø§Ù„Ø¬Ù„Ø³Ø©", "success"); loadUpcomingByRange(); }
}

async function searchCases(){
    const t = document.getElementById('searchInput').value;
    if(!t) return Swal.fire("ØªÙ†Ø¨ÙŠÙ‡","Ø£Ø¯Ø®Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«","info");
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
    
    // ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ù…Ø±ÙˆÙ†Ø© ÙˆÙŠØ´Ù…Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
    const { data, error } = await db.from('cases').select('*, sessions(*)').or(`case_number.ilike.%${t}%,case_year.ilike.%${t}%,client_name.ilike.%${t}%,client_phone.ilike.%${t}%,case_code.ilike.%${t}%`);
    
    Swal.close();
    if(error) { console.error(error); return Swal.fire("Ø®Ø·Ø£","ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«","error"); }
    if(!data || data.length === 0) { searchResults.innerHTML = '<div class="alert alert-info text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>'; return; }
    
    searchResults.innerHTML = `<h6>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (${data.length}):</h6>` + data.map(c => renderCaseCard(c)).join('');
}

async function filterByDateRange() {
    const from = document.getElementById('date_from').value;
    const to = document.getElementById('date_to').value;
    if(!from || !to) return Swal.fire("ØªÙ†Ø¨ÙŠÙ‡","Ø­Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø©","warning");
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
    
    // ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø±Ø¨Ø· Ù„ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª
    const { data, error } = await db.from('cases').select('*, sessions!inner(*)').gte('sessions.session_date', from).lte('sessions.session_date', to);
    
    Swal.close();
    if(error) { console.error(error); return Swal.fire("Ø®Ø·Ø£","ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","error"); }
    if(!data || data.length === 0) { searchResults.innerHTML = '<div class="alert alert-info text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ø¨Ø¬Ù„Ø³Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©</div>'; return; }
    
    searchResults.innerHTML = `<h6>Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„ÙØªØ±Ø© Ù…Ù† ${from} Ø¥Ù„Ù‰ ${to}:</h6>` + data.map(c => renderCaseCard(c)).join('');
}

function renderCaseCard(c) {
    const sess = c.sessions && c.sessions.length > 0 
        ? c.sessions.map(s => `<div class="mt-1 small border-bottom pb-1">ğŸ“… ${s.session_date}: ${s.decision || 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø±'}</div>`).join('') 
        : '<div class="small text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¬Ù„Ø³Ø§Øª</div>';

    return `
        <div class="form-section mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="case-code">${c.case_code}</span>
                <span class="badge bg-gold text-dark">${c.case_status || 'Ù…ØªØ¯Ø§ÙˆÙ„Ø©'}</span>
            </div>
            <div class="row small">
                <div class="col-md-6 mb-1"><span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©:</span> ${c.case_number} / ${c.case_year}</div>
                <div class="col-md-6 mb-1"><span class="detail-label">Ø§Ù„Ù…Ø­ÙƒÙ…Ø©:</span> ${c.court_name}</div>
                <div class="col-md-6 mb-1"><span class="detail-label">Ø§Ù„Ø¹Ù…ÙŠÙ„:</span> ${c.client_name} (${c.client_role})</div>
                <div class="col-md-6 mb-1"><span class="detail-label">Ø§Ù„Ø®ØµÙ…:</span> ${c.opponent_name || '---'}</div>
                <div class="col-12 mb-1"><span class="detail-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</span> ${c.case_subject || '---'}</div>
            </div>
            <hr class="my-2">
            <h6>Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ù‚Ø±Ø§Ø±Ø§Øª:</h6>
            <div class="p-2 bg-light rounded">${sess}</div>
        </div>`;
}

async function loadUpcomingByRange(){
    const from = document.getElementById('s_filter_from').value;
    const to = document.getElementById('s_filter_to').value;
    if(!from || !to) return;
    const { data, error } = await db.from('sessions').select('*, cases(*)').gte('session_date', from).lte('session_date', to).order('session_date');
    if(error || !data || data.length === 0) { upcomingSessions.innerHTML = "<p class='text-center text-muted small'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª</p>"; return; }
    upcomingSessions.innerHTML = data.map(s=>`
        <div class="session-card">
            <div class="d-flex justify-content-between"><b>${s.session_date}</b><small>${s.cases?.court_name || ''}</small></div>
            <div class="small mt-1"><b>Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${s.cases?.client_name || ''} | <b>Ù‚Ø¶ÙŠØ©:</b> ${s.cases?.case_number}/${s.cases?.case_year}</div>
            ${s.decision ? `<div class="mt-1 p-1 bg-light x-small"><b>Ø§Ù„Ù‚Ø±Ø§Ø±:</b> ${s.decision}</div>` : ''}
        </div>`).join('');
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
