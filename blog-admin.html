<!-- ... (نفس قسم الـ Head السابق) ... -->
<style>
    /* إضافة مؤشر حالة الشبكة */
    #status-badge { transition: 0.3s; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; }
    .online { background: #10b981; color: white; }
    .offline { background: #ef4444; color: white; }
</style>

<body class="bg-[#01040f] text-white">

<div class="min-h-screen">
    <header class="border-b border-gold-solid/20 p-5 bg-black/50 sticky top-0 z-50 backdrop-blur-md flex justify-between items-center">
        <h1 class="text-xl font-bold gold-text serif-font">إدارة المحتوى (تطبيق الويب)</h1>
        
        <div class="flex items-center gap-4">
            <!-- مؤشر الاتصال -->
            <div id="status-badge" class="online">متصل</div>
            
            <button onclick="saveLocally()" class="bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-save ml-2"></i> حفظ محلي (بدون نت)
            </button>
            <button onclick="saveArticle('blog/articles')" id="publish-btn" class="btn-gold text-sm">
                <i class="fas fa-paper-plane ml-2"></i> نشر أونلاين
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-4 gap-8">
        <div class="lg:col-span-3 space-y-6">
            <div class="side-panel p-6 rounded-2xl">
                <input type="text" id="postTitle" placeholder="عنوان المقال..." class="input-dark text-3xl font-bold serif-font mb-6">
                <div id="editor"></div>
            </div>
        </div>

        <div class="space-y-6">
            <div class="side-panel p-6 rounded-2xl">
                <h3 class="gold-text font-bold mb-4 text-sm"><i class="fas fa-laptop-code"></i> مسودات هذا الجهاز</h3>
                <div id="local-drafts-list" class="space-y-2">
                    <!-- المسودات المحلية تظهر هنا -->
                </div>
            </div>
        </div>
    </main>
</div>

<!-- كود الربط الذي أرسلته أنت + برمجة العمل بدون إنترنت -->
<script>
    // 1. تسجيل تطبيق الويب PWA
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
        .then(() => console.log('تم تسجيل تطبيق الويب بنجاح'))
        .catch(err => console.log('فشل تسجيل التطبيق', err));
    }
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = 'manifest.json';
    document.head.appendChild(link);

    // 2. مراقبة حالة الإنترنت
    function updateOnlineStatus() {
        const badge = document.getElementById('status-badge');
        if (navigator.onLine) {
            badge.innerText = "متصل";
            badge.className = "online";
        } else {
            badge.innerText = "أوفلاين - حفظ محلي فقط";
            badge.className = "offline";
        }
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    // 3. نظام الحفظ المحلي (بدون إنترنت)
    function saveLocally() {
        const title = document.getElementById('postTitle').value;
        const content = quill.root.innerHTML;
        if(!title) return alert("يرجى كتابة عنوان للمسودة");

        const draft = {
            title: title,
            content: content,
            date: new Date().toLocaleString('ar-EG')
        };

        let drafts = JSON.parse(localStorage.getItem('local_law_drafts') || '[]');
        drafts.push(draft);
        localStorage.setItem('local_law_drafts', JSON.stringify(drafts));
        
        alert("✅ تم حفظ المقال على هاتفك/جهازك بنجاح. يمكنك نشره لاحقاً عند توفر الإنترنت.");
        loadLocalDrafts();
    }

    function loadLocalDrafts() {
        const list = document.getElementById('local-drafts-list');
        const drafts = JSON.parse(localStorage.getItem('local_law_drafts') || '[]');
        list.innerHTML = drafts.map((d, index) => `
            <div class="bg-white/5 p-3 rounded-lg border border-white/10">
                <p class="text-[11px] font-bold truncate">${d.title}</p>
                <div class="flex justify-between mt-2">
                    <button onclick="restoreDraft(${index})" class="text-blue-400 text-[10px]">استرجاع</button>
                    <button onclick="deleteLocalDraft(${index})" class="text-red-500 text-[10px]">حذف</button>
                </div>
            </div>
        `).join('');
    }

    function restoreDraft(index) {
        const drafts = JSON.parse(localStorage.getItem('local_law_drafts') || '[]');
        const d = drafts[index];
        document.getElementById('postTitle').value = d.title;
        quill.root.innerHTML = d.content;
        alert("تم استرجاع المسودة للمحرر.");
    }

    function deleteLocalDraft(index) {
        let drafts = JSON.parse(localStorage.getItem('local_law_drafts') || '[]');
        drafts.splice(index, 1);
        localStorage.setItem('local_law_drafts', JSON.stringify(drafts));
        loadLocalDrafts();
    }

    // استدعاء التحميل عند البدء
    document.addEventListener('DOMContentLoaded', loadLocalDrafts);
</script>

<!-- (باقي أكواد جيت هاب والمحرر Quill السابقة تظل كما هي) -->
