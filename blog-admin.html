<!-- ... (نفس قسم الـ Head والـ Style السابق) ... -->
<body class="bg-[#01040f] text-white">

<div id="lock-screen" class="fixed inset-0 z-[2000] bg-black flex items-center justify-center p-4">
    <!-- شاشة الدخول المعتادة mahmoud237 -->
    <div class="max-w-md w-full text-center bg-[#020617] p-8 rounded-3xl border border-gold-solid/30 shadow-2xl">
        <i class="fas fa-shield-alt text-5xl gold-text mb-4"></i>
        <h2 class="text-2xl font-bold gold-text mb-6">إدارة مؤسسة محمود عبد الحميد</h2>
        <input type="password" id="adminPass" placeholder="كلمة المرور" class="w-full input-dark text-center text-xl mb-6">
        <button onclick="checkPass()" class="btn-gold w-full py-4 text-lg">دخول النظام</button>
    </div>
</div>

<div id="admin-main" class="hidden min-h-screen flex flex-col">
    <header class="border-b border-gold-solid/20 p-3 bg-black/80 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-[1400px] mx-auto flex flex-wrap justify-between items-center gap-3">
            <div class="flex items-center gap-3">
                <h1 class="text-lg font-bold gold-text serif-font">لوحة التحكم الذكية</h1>
                <div id="status-badge" class="online">متصل</div>
            </div>
            
            <div class="flex flex-wrap gap-2">
                <!-- زر لفتح الإعدادات وإدخال التوكن -->
                <button onclick="toggleSettings()" class="bg-gray-800 text-gold-solid p-2 rounded-lg text-xs">
                    <i class="fas fa-cog"></i> الإعدادات
                </button>
                <button onclick="saveArticle('blog/articles')" id="publish-btn" class="btn-gold text-xs">
                    <i class="fas fa-paper-plane"></i> <span id="btn-text">نشر أونلاين</span>
                </button>
            </div>
        </div>
    </header>

    <!-- نافذة الإعدادات (لتغيير التوكن) -->
    <div id="settings-panel" class="hidden bg-[#020617] border-b border-gold-solid/20 p-4">
        <div class="max-w-md mx-auto space-y-3">
            <label class="text-xs text-gold-solid">أدخل GitHub Token الجديد هنا:</label>
            <input type="password" id="ghTokenInput" placeholder="ghp_xxxxxxxxxxxx" class="input-dark text-sm w-full">
            <button onclick="saveToken()" class="btn-gold w-full py-2 text-xs">حفظ التوكن في هذا الجهاز</button>
        </div>
    </div>

    <main class="max-w-[1400px] mx-auto p-4 grid grid-cols-1 lg:grid-cols-4 gap-6 flex-grow w-full">
        <!-- (نفس محتوى الـ Main السابق: المحرر والـ Sidebar) -->
        <div class="lg:col-span-3 space-y-4">
            <div class="side-panel p-4 rounded-xl">
                <input type="text" id="postTitle" placeholder="عنوان المقال..." class="w-full bg-transparent text-2xl font-bold serif-font border-b border-gold-solid/20 pb-3 outline-none mb-4 text-white">
                <div id="editor"></div>
            </div>
        </div>
        
        <div class="space-y-4">
            <!-- قائمة المقالات -->
            <div class="side-panel p-4 rounded-xl flex flex-col max-h-[500px]">
                <h3 class="gold-text font-bold mb-3 flex items-center justify-between text-sm">
                    <span><i class="fas fa-history"></i> الأرشيف</span>
                    <button onclick="loadAllContent()" class="text-blue-400 text-[10px]"><i class="fas fa-sync"></i> تحديث</button>
                </h3>
                <div id="content-list" class="overflow-y-auto space-y-2 flex-grow text-right">
                    <!-- سيظهر هنا رسالة في حال عدم وجود توكن -->
                </div>
            </div>
        </div>
    </main>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    // الحصول على التوكن من ذاكرة الجهاز أو استخدامه من المدخل
    let GITHUB_TOKEN = localStorage.getItem('mahmoud_gh_token') || "";
    const OWNER = "malegal";
    const REPO = "mahmoud-legal";

    function toggleSettings() {
        document.getElementById('settings-panel').classList.toggle('hidden');
    }

    function saveToken() {
        const val = document.getElementById('ghTokenInput').value;
        if(val) {
            localStorage.setItem('mahmoud_gh_token', val);
            GITHUB_TOKEN = val;
            alert("تم حفظ التوكن بنجاح! سيتم الآن تحميل الأرشيف.");
            toggleSettings();
            loadAllContent();
        }
    }

    async function loadAllContent() {
        const listDiv = document.getElementById('content-list');
        if(!GITHUB_TOKEN) {
            listDiv.innerHTML = '<p class="text-center text-[10px] text-yellow-500 py-4">يرجى إدخال التوكن من الإعدادات أولاً</p>';
            return;
        }

        listDiv.innerHTML = '<p class="text-center text-xs py-4 italic">جاري جلب البيانات...</p>';
        
        try {
            const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/blog/articles`, {
                headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
            });

            if(res.status === 401) {
                listDiv.innerHTML = '<p class="text-center text-[10px] text-red-500 py-4">التوكن غير صالح أو انتهت صلاحيته</p>';
                return;
            }

            if(res.status === 404) {
                listDiv.innerHTML = '<p class="text-center text-[10px] text-gray-500 py-4">لا توجد مقالات منشورة بعد</p>';
                return;
            }

            const files = await res.json();
            listDiv.innerHTML = files.filter(f => f.name.endsWith('.md')).map(file => {
                const title = decodeURIComponent(file.name.replace('.md', '').replace(/-/g, ' '));
                return `
                    <div class="article-card flex justify-between items-center gap-2">
                        <span class="text-[10px] truncate font-bold flex-grow">${title}</span>
                        <div class="flex gap-1">
                            <button onclick="editRemote('${file.path}', '${file.sha}')" class="bg-blue-500/20 text-blue-400 p-2 rounded text-[10px]"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteRemote('${file.path}', '${file.sha}')" class="bg-red-500/20 text-red-500 p-2 rounded text-[10px]"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
            }).join('');
        } catch (e) {
            listDiv.innerHTML = '<p class="text-center text-red-500 text-[10px]">فشل الاتصال بالخادم</p>';
        }
    }

    // بقية الوظائف (checkPass, saveArticle, editRemote, deleteRemote) تظل كما هي
    // مع ملاحظة استخدام متغير GITHUB_TOKEN في كل fetch
</script>
<!-- ... (باقي الكود السابق) ... -->
