<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ© - Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --gold: #bf953f;
            --gold-light: #fcf6ba;
            --dark: #020617;
            --dark-2: #0f172a;
            --gray: #94a3b8;
            --light: #f8fafc;
            --red: #ef4444;
            --green: #10b981;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-2) 100%);
            color: var(--light);
            min-height: 100vh;
            position: relative;
        }

        /* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
        .watermark {
            position: fixed;
            pointer-events: none;
            opacity: 0.03;
            z-index: 9999;
            color: var(--red);
            font-weight: bold;
            font-size: 24px;
            white-space: nowrap;
            transform: rotate(-45deg);
        }

        .watermark-1 { top: 20%; left: 10%; }
        .watermark-2 { top: 50%; left: 30%; }
        .watermark-3 { top: 80%; left: 50%; }
        .watermark-4 { top: 40%; left: 70%; }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; position: relative; z-index: 1; }

        .header {
            background: rgba(0,0,0,0.9);
            border-bottom: 2px solid var(--gold);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 12px 0;
        }

        .navbar { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gold);
            text-decoration: none;
        }

        .logo-img { width: 54px; height: 54px; object-fit: contain; border-radius: 8px; }

        .logo-text h1 { font-size: 1.4rem; margin: 0; color: var(--gold-light); }
        .logo-text h2 { font-size: 0.95rem; margin: 0; color: var(--gold); }

        .btn {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: var(--dark);
            padding: 10px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(191,149,63,0.3); }

        .inquiry-box {
            background: rgba(0,0,0,0.75);
            border: 1px solid rgba(191,149,63,0.25);
            border-radius: 20px;
            padding: 32px;
            margin: 40px auto;
            max-width: 780px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            position: relative;
        }

        h1 { color: var(--gold); text-align: center; margin-bottom: 1.2rem; font-size: 1.9rem; }

        .form-group { margin-bottom: 1.6rem; text-align: right; }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold);
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.06);
            border: 1.5px solid rgba(191,149,63,0.35);
            border-radius: 10px;
            color: white;
            font-size: 1.05rem;
            transition: 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(191,149,63,0.18);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: var(--dark);
            width: 100%;
            padding: 16px;
            font-size: 1.15rem;
            margin-top: 0.8rem;
        }

        .result-box {
            display: none;
            background: rgba(0,0,0,0.4);
            border: 2px solid var(--gold);
            border-radius: 16px;
            padding: 24px;
            margin-top: 2rem;
            position: relative;
        }

        .session-token {
            background: rgba(191,149,63,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(191,149,63,0.3);
            text-align: center;
        }

        .token-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .token-label { color: var(--gray); font-size: 0.9rem; }
        .token-value { 
            color: var(--gold-light); 
            font-weight: 600; 
            font-family: monospace;
            direction: ltr;
            letter-spacing: 1px;
        }

        .session-timer {
            color: var(--red);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .info-item {
            background: rgba(191,149,63,0.08);
            padding: 14px;
            border-radius: 10px;
            border: 1px solid rgba(191,149,63,0.2);
            position: relative;
        }

        .sensitive-data {
            filter: blur(3px);
            transition: filter 0.3s;
            cursor: pointer;
            position: relative;
        }

        .sensitive-data:hover {
            filter: blur(0);
        }

        .sensitive-data::after {
            content: "Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø±";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: var(--gold);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sensitive-data:hover::after {
            opacity: 1;
        }

        .info-label { color: var(--gray); font-size: 0.9rem; margin-bottom: 0.4rem; }
        .info-value { color: var(--gold-light); font-weight: 600; font-size: 1.1rem; }

        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            display: none;
        }

        .error   { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid #f87171; }
        .success { background: rgba(34,197,94,0.2); color: #4ade80; border: 1px solid #4ade80; }

        .loading {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
            color: transparent !important;
        }

        .loading::after {
            content: '';
            position: absolute;
            inset: 0;
            margin: auto;
            width: 20px; height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: var(--dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .legal-notice {
            background: rgba(239,68,68,0.1);
            border: 2px solid var(--red);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .legal-notice h3 {
            color: var(--red);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .legal-notice p {
            color: var(--light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .session-item {
            background: rgba(191,149,63,0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-right: 3px solid var(--gold);
        }

        .contact-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(191,149,63,0.1);
            border-radius: 12px;
            border: 1px solid rgba(191,149,63,0.3);
            text-align: center;
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .contact-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 1px solid rgba(191,149,63,0.2);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .contact-item:hover {
            transform: translateY(-3px);
            background: rgba(191,149,63,0.15);
            box-shadow: 0 5px 15px rgba(191,149,63,0.2);
        }

        .contact-item i {
            font-size: 20px;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .contact-item span {
            color: var(--light);
            font-size: 13px;
            margin-bottom: 3px;
        }

        .contact-link {
            color: var(--gold-light);
            text-decoration: none;
            font-weight: bold;
            font-size: 15px;
        }

        @media (max-width: 640px) {
            .inquiry-box { padding: 20px; }
            .info-grid { grid-template-columns: 1fr; }
            .contact-info { grid-template-columns: 1fr; }
            .token-info { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

<!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ© -->
<div class="watermark watermark-1" id="watermark1"></div>
<div class="watermark watermark-2" id="watermark2"></div>
<div class="watermark watermark-3" id="watermark3"></div>
<div class="watermark watermark-4" id="watermark4"></div>

<header class="header">
    <div class="container">
        <nav class="navbar">
            <a href="#" class="logo">
                <img src="https://raw.githubusercontent.com/malegal/mahmoud-legal/main/logo.png" class="logo-img" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨" onerror="this.src='https://via.placeholder.com/54?text=âš–ï¸'">
                <div class="logo-text">
                    <h1>Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯</h1>
                    <h2>Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø© â€“ Ø§Ù„Ù†Ù‚Ø¶ ÙˆØ§Ù„Ø¯Ø³ØªÙˆØ±ÙŠØ© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
                </div>
            </a>
            <button class="btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
        </nav>
    </div>
</header>

<main class="container">
    <div class="inquiry-box">
        <h1><i class="fas fa-balance-scale"></i> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©</h1>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… -->
        <div id="inquiry-form">
            <div class="form-group">
                <label for="identifier"><i class="fas fa-user"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="text" id="identifier" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                <small style="color:var(--gray); display:block; margin-top:5px;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„</small>
            </div>

            <div class="form-group">
                <label for="caseCode"><i class="fas fa-file-contract"></i> ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
                <input type="text" id="caseCode" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©" style="text-transform:uppercase;">
                <small style="color:var(--gray); display:block; margin-top:5px;">ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ</small>
            </div>

            <!-- Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ -->
            <div class="legal-notice">
                <h3><i class="fas fa-exclamation-triangle"></i> ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø§Ù†ÙˆÙ†ÙŠ</h3>
                <p>
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù‡ÙŠ Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø§Ù„Ø´Ø®ØµÙŠ ÙÙ‚Ø·. Ø£ÙŠ ØªØµÙˆÙŠØ±ØŒ Ø·Ø¨Ø§Ø¹Ø©ØŒ Ø£Ùˆ ØªØ¯Ø§ÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙˆÙ† Ø¥Ø°Ù† ÙƒØªØ§Ø¨ÙŠ Ù…Ù† Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ù…Ø­Ø§Ù…Ø§Ø© ÙŠØ¹Ø±Ø¶ ØµØ§Ø­Ø¨Ù‡ Ù„Ù„Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†.
                </p>
            </div>

            <button type="button" id="btn-inquiry" class="btn btn-primary">
                <i class="fas fa-search"></i> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©
            </button>
        </div>

        <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div id="msg-error" class="message error"></div>
        <div id="msg-success" class="message success"></div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù‚Ø¶ÙŠØ© -->
        <div id="result-box" class="result-box">
            <!-- ØªØ°ÙƒØ±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© -->
            <div class="session-token">
                <h3 style="color:var(--gold); margin-bottom:10px;">
                    <i class="fas fa-ticket-alt"></i> ØªØ°ÙƒØ±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                </h3>
                <div class="token-info">
                    <div>
                        <div class="token-label">Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©</div>
                        <div class="token-value" id="session-uuid">-</div>
                    </div>
                    <div>
                        <div class="token-label">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø®Ù„Ø§Ù„</div>
                        <div class="session-timer" id="session-timer">15:00</div>
                    </div>
                </div>
                <small style="color:var(--gray); display:block; margin-top:10px;">
                    <i class="fas fa-info-circle"></i> Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© ØµØ§Ù„Ø­Ø© Ù„Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø© ÙÙ‚Ø·
                </small>
            </div>

            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© -->
            <h2 style="color:var(--gold); margin-bottom:20px; text-align:center;">
                <i class="fas fa-file-contract"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©
            </h2>
            
            <div class="info-grid" id="case-info-grid">
                <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <div class="session-item" id="case-subject">
                <div class="info-label"><i class="fas fa-file-alt"></i> Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value" id="resultCaseSubject">-</div>
            </div>
            
            <h3 style="color:var(--gold); margin:25px 0 15px 0; display:flex; align-items:center; gap:10px; font-size:18px;">
                <i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            </h3>
            
            <div id="sessionsContainer">
                <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <div class="contact-section">
                <h3><i class="fas fa-headset"></i> Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø±:</h3>
                
                <div class="contact-info">
                    <a href="#" class="contact-item" onclick="openWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                        <span>Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</span>
                        <span class="contact-link">01101076000</span>
                    </a>
                    
                    <a href="#" class="contact-item" onclick="openEmail()">
                        <i class="fas fa-envelope"></i>
                        <span>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                        <span class="contact-link">ma.law.firm@outlook.com</span>
                    </a>
                </div>
                
                <p style="color:var(--gray); font-size:0.9rem; margin-top:15px;">
                    <i class="fas fa-shield-alt"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ù…ÙŠØ© ÙˆÙ…Ø³Ø¬Ù„Ø© Ø±Ù‚Ù…ÙŠØ§Ù‹
                </p>
            </div>
        </div>
    </div>
</main>

<footer style="background:rgba(0,0,0,0.9); padding:25px 0; text-align:center; border-top:1px solid rgba(191,149,63,0.2); margin-top:40px;">
    <div class="container">
        <p style="color:var(--gray); font-size:14px;">Â© 2024 Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ù…Ø­Ø§Ù…Ø§Ø©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        <p style="color:var(--gray); font-size:14px; margin-top:8px;">
            <i class="fas fa-lock"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù…Ù† | 
            <i class="fas fa-clock"></i> Ø§Ù„Ø¬Ù„Ø³Ø§Øª ØªÙ†ØªÙ‡ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 15 Ø¯Ù‚ÙŠÙ‚Ø©
        </p>
    </div>
</footer>

<script>
// ============================================
// ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
const CONFIG = {
    SUPABASE_URL: 'https://iyhfafodhptcdwrjywek.supabase.co',
    SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5aGZhZm9kaHB0Y2R3cmp5d2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMzUzODYsImV4cCI6MjA4MjcxMTM4Nn0.YmeMSDkQ3Z_vpyMTyZ-3jbKLFzVZzwcLeDsdczrErHQ',
    SESSION_DURATION: 15 * 60 * 1000, // 15 Ø¯Ù‚ÙŠÙ‚Ø©
    SESSION_KEY: 'mahmoud_law_session',
    WATERMARK_KEY: 'mahmoud_law_watermark'
};

// ============================================
// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
let supabaseClient = null;
let currentSession = null;
let sessionTimer = null;
let sessionExpires = null;
let watermarkData = null;

// ============================================
// ØªÙˆÙ„ÙŠØ¯ UUID
// ============================================
function generateUUID() {
    return 'xxxx-xxxx-4xxx-yxxx-xxxx-xxxx-xxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    }).toUpperCase();
}

// ============================================
// Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
// ============================================
function updateWatermarks(identifier, caseCode, sessionId) {
    watermarkData = {
        identifier: identifier || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
        caseCode: caseCode || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
        sessionId: sessionId || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
        timestamp: new Date().toLocaleString('ar-EG'),
        ip: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...'
    };
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
    const watermarks = [
        `ID: ${identifier?.substring(0, 8)}...`,
        `Case: ${caseCode}`,
        `Session: ${sessionId?.substring(0, 8)}...`,
        `Time: ${new Date().toLocaleTimeString('ar-EG')}`,
        `Date: ${new Date().toLocaleDateString('ar-EG')}`
    ];
    
    document.getElementById('watermark1').textContent = watermarks[0];
    document.getElementById('watermark2').textContent = watermarks[1];
    document.getElementById('watermark3').textContent = watermarks[2];
    document.getElementById('watermark4').textContent = watermarks[3];
    
    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
    localStorage.setItem(CONFIG.WATERMARK_KEY, JSON.stringify(watermarkData));
}

// ============================================
// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª
// ============================================
function createSession(identifier, caseCode) {
    const sessionId = generateUUID();
    const expires = Date.now() + CONFIG.SESSION_DURATION;
    
    currentSession = {
        id: sessionId,
        identifier: identifier,
        caseCode: caseCode,
        expires: expires,
        created: Date.now(),
        ip: window.location.hostname
    };
    
    sessionExpires = expires;
    
    // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
    localStorage.setItem(CONFIG.SESSION_KEY, JSON.stringify(currentSession));
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
    updateWatermarks(identifier, caseCode, sessionId);
    
    // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©
    startSessionTimer();
    
    // Ù…Ù†Ø¹ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
    setupTabProtection();
    
    console.log('âœ… Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©:', sessionId);
    return sessionId;
}

function loadSession() {
    const sessionData = localStorage.getItem(CONFIG.SESSION_KEY);
    const watermarkData = localStorage.getItem(CONFIG.WATERMARK_KEY);
    
    if (sessionData) {
        currentSession = JSON.parse(sessionData);
        sessionExpires = currentSession.expires;
        
        if (Date.now() < sessionExpires) {
            // Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©
            updateWatermarks(
                currentSession.identifier,
                currentSession.caseCode,
                currentSession.id
            );
            startSessionTimer();
            setupTabProtection();
            return true;
        } else {
            // Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©
            clearSession();
            return false;
        }
    }
    return false;
}

function clearSession() {
    currentSession = null;
    sessionExpires = null;
    
    localStorage.removeItem(CONFIG.SESSION_KEY);
    localStorage.removeItem(CONFIG.WATERMARK_KEY);
    
    if (sessionTimer) {
        clearInterval(sessionTimer);
    }
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
    document.querySelectorAll('.watermark').forEach(wm => {
        wm.textContent = '';
    });
    
    console.log('ğŸ—‘ï¸ Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ… Ù…Ø³Ø­Ù‡Ø§');
}

function startSessionTimer() {
    if (sessionTimer) {
        clearInterval(sessionTimer);
    }
    
    sessionTimer = setInterval(() => {
        const now = Date.now();
        const remaining = sessionExpires - now;
        
        if (remaining <= 0) {
            clearInterval(sessionTimer);
            sessionExpired();
            return;
        }
        
        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);
        
        document.getElementById('session-timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
        if (minutes < 2) {
            document.getElementById('session-timer').style.color = 'var(--red)';
        } else if (minutes < 5) {
            document.getElementById('session-timer').style.color = 'var(--gold)';
        }
        
    }, 1000);
}

function sessionExpired() {
    showAlert('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©', 'Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù….', 'warning');
    logout();
}

// ============================================
// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
// ============================================
function setupTabProtection() {
    // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©
    const tabId = generateUUID();
    sessionStorage.setItem('tab_id', tabId);
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    window.addEventListener('storage', function(e) {
        if (e.key === CONFIG.SESSION_KEY && e.newValue) {
            // ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯ ÙØªØ­ Ø¬Ù„Ø³Ø©
            if (sessionStorage.getItem('tab_id') !== tabId) {
                showAlert('ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ', 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¬Ù„Ø³Ø© ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¢Ø®Ø±. Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø³ØªÙ†ØªÙ‡ÙŠ.', 'error');
                setTimeout(logout, 2000);
            }
        }
    });
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', function(e) {
        if (currentSession) {
            // Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø¯ÙˆÙ† ØªØ­Ø°ÙŠØ±
            e.preventDefault();
            e.returnValue = 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ';
        }
    });
}

// ============================================
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ”’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù…Ù† - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...');
    
    // ØªÙ‡ÙŠØ¦Ø© Supabase
    try {
        supabaseClient = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
        console.log('âœ… Supabase: ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø©');
    } catch (error) {
        console.error('âŒ Supabase: ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©', error);
        showAlert('Ø®Ø·Ø£', 'ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
    }
    
    // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    bindEvents();
    
    // ØªØ­Ù…ÙŠÙ„ Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©
    if (loadSession()) {
        showInquiryResult();
    }
    
    console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²');
});

// ============================================
// Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
// ============================================
function bindEvents() {
    // Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
    document.getElementById('btn-inquiry').addEventListener('click', performInquiry);
    
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
    document.getElementById('identifier').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performInquiry();
    });
    
    document.getElementById('caseCode').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performInquiry();
    });
    
    // Ù…Ù†Ø¹ Ù†Ø³Ø® Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('copy', function(e) {
        if (currentSession) {
            showMessage('error', 'Ù…Ù…Ù†ÙˆØ¹ Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰');
            e.preventDefault();
        }
    });
    
    // Ù…Ù†Ø¹ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø© (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Print Screen)
    document.addEventListener('keydown', function(e) {
        if (currentSession && (e.key === 'PrintScreen' || (e.ctrlKey && e.key === 'p'))) {
            e.preventDefault();
            showMessage('error', 'Ù…Ù…Ù†ÙˆØ¹ Ø£Ø®Ø° Ù„Ù‚Ø·Ø© Ù„Ù„Ø´Ø§Ø´Ø©');
        }
    });
    
    // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø£ÙŠÙ…Ù†
    document.addEventListener('contextmenu', function(e) {
        if (currentSession) {
            e.preventDefault();
            showMessage('error', 'Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø£ÙŠÙ…Ù†');
        }
    });
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
// ============================================
function hideMessages() {
    document.getElementById('msg-error').style.display = 'none';
    document.getElementById('msg-success').style.display = 'none';
}

function showMessage(type, text) {
    const el = document.getElementById(`msg-${type}`);
    el.textContent = text;
    el.style.display = 'block';
    console.log(`${type.toUpperCase()}:`, text);
    
    setTimeout(() => {
        el.style.display = 'none';
    }, 5000);
}

function showAlert(title, text, icon = 'info') {
    Swal.fire({
        title: title,
        text: text,
        icon: icon,
        confirmButtonColor: 'var(--gold)',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
}

function setLoading(loading = true) {
    const btn = document.getElementById('btn-inquiry');
    if (!btn) return;
    
    if (loading) {
        btn.classList.add('loading');
        btn.disabled = true;
        btn.innerHTML = '<span style="visibility:hidden;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</span>';
    } else {
        btn.classList.remove('loading');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-search"></i> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©';
    }
}

// ============================================
// ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
// ============================================
async function performInquiry() {
    const identifier = document.getElementById('identifier').value.trim();
    const caseCode = document.getElementById('caseCode').value.trim().toUpperCase();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
    if (!identifier) {
        showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        return;
    }
    
    if (!caseCode) {
        showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©');
        return;
    }
    
    setLoading(true);
    hideMessages();
    
    try {
        console.log('ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«:', { identifier, caseCode });
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const { data: caseData, error } = await supabaseClient
            .from('cases')
            .select(`
                *,
                sessions (*)
            `)
            .eq('case_code', caseCode)
            .or(`client_email.ilike.%${identifier}%,client_phone.ilike.%${identifier}%`)
            .single();
        
        if (error || !caseData) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø¶ÙŠØ© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©');
        }
        
        console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø¶ÙŠØ©:', caseData.case_code);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
        const sessionId = createSession(identifier, caseCode);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        displayCaseDetails(caseData, sessionId);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        showInquiryResult();
        
        showMessage('success', 'ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:', error);
        showMessage('error', error.message);
        
        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ§Ø´Ù„Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        logFailedAttempt(identifier, caseCode);
        
    } finally {
        setLoading(false);
    }
}

function logFailedAttempt(identifier, caseCode) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø© Ù‡Ù†Ø§
    console.log('âŒ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ§Ø´Ù„Ø©:', { identifier, caseCode, timestamp: new Date().toISOString() });
}

// ============================================
// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©
// ============================================
function displayCaseDetails(caseData, sessionId) {
    try {
        // ØªØ­Ø¯ÙŠØ« ØªØ°ÙƒØ±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
        document.getElementById('session-uuid').textContent = sessionId;
        
        // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
        const infoGrid = document.getElementById('case-info-grid');
        
        infoGrid.innerHTML = `
            <div class="info-item">
                <div class="info-label"><i class="fas fa-hashtag"></i> ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value">${caseData.case_code || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value sensitive-data" title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø±">
                    ${maskCaseNumber(caseData.case_number || '-')}
                </div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-calendar"></i> Ø³Ù†Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value">${caseData.case_year || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div class="info-value sensitive-data" title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø±">
                    ${maskName(caseData.client_name || '-')}
                </div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user-tag"></i> ØµÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div class="info-value">${caseData.client_role || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user-friends"></i> Ø§Ø³Ù… Ø§Ù„Ø®ØµÙ…</div>
                <div class="info-value sensitive-data" title="Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø±">
                    ${maskName(caseData.opponent_name || '-')}
                </div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-gavel"></i> Ø§Ù„Ù…Ø­ÙƒÙ…Ø©</div>
                <div class="info-value">${caseData.court || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-balance-scale"></i> Ø§Ù„Ø­Ø§Ù„Ø©</div>
                <div class="info-value">${getStatusBadge(caseData.status || '-')}</div>
            </div>
        `;
        
        document.getElementById('resultCaseSubject').textContent = caseData.subject || '-';
        
        // Ø¥Ø¶Ø§ÙØ© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
        document.querySelectorAll('.sensitive-data').forEach(item => {
            item.addEventListener('click', function() {
                this.classList.toggle('revealed');
                if (this.classList.contains('revealed')) {
                    const original = this.getAttribute('data-original') || this.textContent.replace(/â€¢/g, '');
                    this.textContent = original;
                }
            });
        });
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        const sessionsContainer = document.getElementById('sessionsContainer');
        if (caseData.sessions && caseData.sessions.length > 0) {
            const sortedSessions = [...caseData.sessions].sort((a, b) => 
                new Date(b.session_date) - new Date(a.session_date)
            );
            
            let sessionsHTML = '';
            sortedSessions.forEach(session => {
                const sessionDate = new Date(session.session_date);
                const formattedDate = sessionDate.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                sessionsHTML += `
                    <div class="session-item">
                        <div style="color:var(--gold); font-weight:bold; margin-bottom:8px; display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-calendar-day"></i>
                            ${formattedDate}
                        </div>
                        <div style="color:var(--light); margin-bottom:5px;">
                            <i class="fas fa-info-circle"></i> Ø§Ù„Ù‚Ø±Ø§Ø±: ${session.decision || 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø±'}
                        </div>
                        ${session.notes ? `<div style="color:var(--gray); font-size:14px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${session.notes}</div>` : ''}
                    </div>
                `;
            });
            
            sessionsContainer.innerHTML = sessionsHTML;
        } else {
            sessionsContainer.innerHTML = `
                <div class="session-item">
                    <div style="color:var(--gray); text-align:center; padding:15px;">
                        <i class="fas fa-calendar-times"></i>
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ø¹Ø¯
                    </div>
                </div>
            `;
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
    }
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
// ============================================
function maskCaseNumber(caseNumber) {
    if (!caseNumber || caseNumber === '-') return '-';
    
    // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø±Ù‚Ù… Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø·Ø±Ø§Ù ÙÙ‚Ø·
    const length = caseNumber.length;
    if (length <= 4) return 'â€¢â€¢â€¢â€¢';
    
    const visibleStart = caseNumber.substring(0, 2);
    const visibleEnd = caseNumber.substring(length - 2);
    const hidden = 'â€¢'.repeat(Math.max(0, length - 4));
    
    return `${visibleStart}${hidden}${visibleEnd}`;
}

function maskName(name) {
    if (!name || name === '-') return '-';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ø³Ù… Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø£Ø®ÙŠØ±
    const parts = name.split(' ');
    const maskedParts = parts.map(part => {
        if (part.length <= 2) return 'â€¢â€¢';
        return `${part[0]}${'â€¢'.repeat(part.length - 2)}${part[part.length - 1]}`;
    });
    
    return maskedParts.join(' ');
}

function getStatusBadge(status) {
    const statusMap = {
        'Ø¬Ø§Ø±ÙŠØ©': '<span style="color:var(--gold);">ğŸŸ¡ Ø¬Ø§Ø±ÙŠØ©</span>',
        'Ù…Ù†ØªÙ‡ÙŠØ©': '<span style="color:var(--green);">ğŸŸ¢ Ù…Ù†ØªÙ‡ÙŠØ©</span>',
        'Ù…Ù„ØºÙŠØ©': '<span style="color:var(--red);">ğŸ”´ Ù…Ù„ØºÙŠØ©</span>',
        'Ù…Ø¤Ø¬Ù„Ø©': '<span style="color:var(--gray);">âšª Ù…Ø¤Ø¬Ù„Ø©</span>'
    };
    
    return statusMap[status] || `<span>${status}</span>`;
}

// ============================================
// Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
// ============================================
function showInquiryResult() {
    document.getElementById('inquiry-form').style.display = 'none';
    document.getElementById('result-box').style.display = 'block';
    
    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showInquiryForm() {
    document.getElementById('inquiry-form').style.display = 'block';
    document.getElementById('result-box').style.display = 'none';
    
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('identifier').value = '';
    document.getElementById('caseCode').value = '';
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
// ============================================
function logout() {
    clearSession();
    showInquiryForm();
    hideMessages();
    showAlert('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬', 'ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function openWhatsApp() {
    const message = currentSession ? 
        `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØªÙŠ Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯: ${currentSession.caseCode}` :
        'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©';
    window.open(`https://wa.me/201101076000?text=${encodeURIComponent(message)}`, '_blank');
}

function openEmail() {
    const subject = currentSession ? 
        `Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ© ${currentSession.caseCode}` :
        'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©';
    const body = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ\n\nØ£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©\n\nÙ…Ø¹ Ø§Ù„Ø´ÙƒØ±`;
    window.location.href = `mailto:ma.law.firm@outlook.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

// ============================================
// Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
// ============================================
// Ù…Ù†Ø¹ ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
setInterval(function() {
    if (currentSession) {
        if (window.outerHeight - window.innerHeight > 100 || 
            window.outerWidth - window.innerWidth > 100) {
            // ØªÙ… ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
            showAlert('ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ', 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±', 'error');
            logout();
        }
    }
}, 1000);

// Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªØµÙØ­ Ø§Ù„ØªØ§Ø±ÙŠØ®
history.pushState(null, null, location.href);
window.onpopstate = function(event) {
    history.go(1);
    if (currentSession) {
        showMessage('error', 'Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù†Ø´Ø·Ø©');
    }
};

// Ù…Ù†Ø¹ ÙØªØ­ Ø§Ù„Ø¥Ø·Ø§Ø± ÙÙŠ iframe
if (window.top !== window.self) {
    window.top.location = window.self.location;
}

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù…Ù† - Ø§Ù„Ø¥ØµØ¯Ø§Ø±     â•‘
â•‘â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•‘
â•‘ âœ… Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª                 â•‘
â•‘ âœ… Ø¬Ù„Ø³Ø§Øª Ù…Ø¤Ù‚ØªØ© (15 Ø¯Ù‚ÙŠÙ‚Ø©)               â•‘
â•‘ âœ… Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø§Ø¦ÙŠØ© Ø°ÙƒÙŠØ©                    â•‘
â•‘ âœ… Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ù„Ù‚Ø·Ø§Øª                   â•‘
â•‘ âœ… Ø­Ù…Ø§ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª               â•‘
â•‘ âœ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©               â•‘
â•‘ âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);
</script>
</body>
</html>
