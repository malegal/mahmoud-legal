<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ© - Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --gold: #bf953f;
            --gold-light: #fcf6ba;
            --dark: #020617;
            --dark-2: #0f172a;
            --gray: #94a3b8;
            --light: #f8fafc;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-2) 100%);
            color: var(--light);
            min-height: 100vh;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }

        .header {
            background: rgba(0,0,0,0.9);
            border-bottom: 2px solid var(--gold);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 12px 0;
        }

        .navbar { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gold);
            text-decoration: none;
        }

        .logo-img { width: 54px; height: 54px; object-fit: contain; border-radius: 8px; }

        .logo-text h1 { font-size: 1.4rem; margin: 0; color: var(--gold-light); }
        .logo-text h2 { font-size: 0.95rem; margin: 0; color: var(--gold); }

        .btn {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: var(--dark);
            padding: 10px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(191,149,63,0.3); }

        .inquiry-box {
            background: rgba(0,0,0,0.75);
            border: 1px solid rgba(191,149,63,0.25);
            border-radius: 20px;
            padding: 32px;
            margin: 40px auto;
            max-width: 780px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        }

        h1 { color: var(--gold); text-align: center; margin-bottom: 1.2rem; font-size: 1.9rem; }

        .form-group { margin-bottom: 1.6rem; text-align: right; }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold);
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.06);
            border: 1.5px solid rgba(191,149,63,0.35);
            border-radius: 10px;
            color: white;
            font-size: 1.05rem;
            transition: 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(191,149,63,0.18);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: var(--dark);
            width: 100%;
            padding: 16px;
            font-size: 1.15rem;
            margin-top: 0.8rem;
        }

        .result-box {
            display: none;
            background: rgba(0,0,0,0.4);
            border: 2px solid var(--gold);
            border-radius: 16px;
            padding: 24px;
            margin-top: 2rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .info-item {
            background: rgba(191,149,63,0.08);
            padding: 14px;
            border-radius: 10px;
            border: 1px solid rgba(191,149,63,0.2);
        }

        .info-label { color: var(--gray); font-size: 0.9rem; margin-bottom: 0.4rem; }
        .info-value { color: var(--gold-light); font-weight: 600; font-size: 1.1rem; }

        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            display: none;
        }

        .error   { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid #f87171; }
        .success { background: rgba(34,197,94,0.2); color: #4ade80; border: 1px solid #4ade80; }

        .loading {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
            color: transparent !important;
        }

        .loading::after {
            content: '';
            position: absolute;
            inset: 0;
            margin: auto;
            width: 20px; height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: var(--dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .verification-btn {
            opacity: 0.6;
            border: 1px solid transparent;
            background: rgba(191,149,63,0.1);
            color: var(--light);
            font-weight: 600;
            transition: all 0.3s;
        }

        .verification-btn.active {
            opacity: 1;
            border: 2px solid var(--gold);
            box-shadow: 0 0 15px rgba(191,149,63,0.4);
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: var(--dark);
        }

        .session-item {
            background: rgba(191,149,63,0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-right: 3px solid var(--gold);
        }

        .otp-display {
            background: rgba(191,149,63,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed var(--gold);
        }

        .otp-display .code {
            font-size: 48px;
            font-weight: bold;
            color: var(--gold-light);
            letter-spacing: 10px;
            font-family: monospace;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            direction: ltr;
        }

        .contact-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(191,149,63,0.1);
            border-radius: 12px;
            border: 1px solid rgba(191,149,63,0.3);
            text-align: center;
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .contact-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 1px solid rgba(191,149,63,0.2);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .contact-item:hover {
            transform: translateY(-3px);
            background: rgba(191,149,63,0.15);
            box-shadow: 0 5px 15px rgba(191,149,63,0.2);
        }

        .contact-item i {
            font-size: 20px;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .contact-item span {
            color: var(--light);
            font-size: 13px;
            margin-bottom: 3px;
        }

        .contact-link {
            color: var(--gold-light);
            text-decoration: none;
            font-weight: bold;
            font-size: 15px;
        }

        @media (max-width: 640px) {
            .inquiry-box { padding: 20px; }
            .info-grid { grid-template-columns: 1fr; }
            .contact-info { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="container">
        <nav class="navbar">
            <a href="#" class="logo">
                <img src="https://raw.githubusercontent.com/malegal/mahmoud-legal/main/logo.png" class="logo-img" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨" onerror="this.src='https://via.placeholder.com/54?text=âš–ï¸'">
                <div class="logo-text">
                    <h1>Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯</h1>
                    <h2>Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø© â€“ Ø§Ù„Ù†Ù‚Ø¶ ÙˆØ§Ù„Ø¯Ø³ØªÙˆØ±ÙŠØ© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
                </div>
            </a>
            <a href="index.html" class="btn"><i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </nav>
    </div>
</header>

<main class="container">
    <div class="inquiry-box">
        <h1><i class="fas fa-balance-scale"></i> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©</h1>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
        <div id="step-method">
            <h3 style="color:var(--gold); margin:1.5rem 0 1rem; text-align:right;">
                <i class="fas fa-shield-halved"></i> Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªØ­Ù‚Ù‚
            </h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:2rem;">
                <button type="button" class="btn verification-btn active" id="method-email">
                    <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                </button>
                <button type="button" class="btn verification-btn" id="method-telegram">
                    <i class="fab fa-telegram-plane"></i> Telegram
                </button>
            </div>
        </div>

        <!-- Ø®Ø·ÙˆØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
        <div id="step-email" class="method-step" style="display:block;">
            <div class="form-group">
                <label for="email"><i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„</label>
                <input type="email" id="email" class="form-control" placeholder="example@domain.com">
                <small style="color:var(--gray); display:block; margin-top:5px;">Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø«Ù… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</small>
            </div>
            <button type="button" id="btn-send-email" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚
            </button>
        </div>

        <!-- Ø®Ø·ÙˆØ© Telegram -->
        <div id="step-telegram" class="method-step" style="display:none;">
            <div class="form-group">
                <label for="telegram"><i class="fab fa-telegram-plane"></i> Ù…Ø¹Ø±Ù Telegram (Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Chat ID)</label>
                <input type="text" id="telegram" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ø£Ùˆ Chat ID">
                <small style="color:var(--gray); display:block; margin-top:5px;">
                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…:<br>
                    â€¢ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø«Ø§Ù„: 201112345678)<br>
                    â€¢ Ø£Ùˆ Chat ID (Ø§Ø­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† @userinfobot)
                </small>
            </div>
            <div style="background:rgba(191,149,63,0.12); padding:1rem; border-radius:10px; margin:1.2rem 0; font-size:0.95rem;">
                <p><strong><i class="fas fa-info-circle"></i> Ù…Ù‡Ù…:</strong> ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ @Lawyer_OTP_Bot Ø£ÙˆÙ„Ø§Ù‹</p>
                <a href="https://t.me/Lawyer_OTP_Bot" target="_blank" 
                   style="color:var(--gold); font-weight:600; display:inline-flex; align-items:center; gap:8px; margin-top:0.6rem;">
                    <i class="fab fa-telegram-plane"></i> Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙˆØª
                </a>
            </div>
            <button type="button" id="btn-send-telegram" class="btn btn-primary">
                <i class="fab fa-telegram-plane"></i> Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚
            </button>
        </div>

        <!-- Ø®Ø·ÙˆØ© Ø¥Ø¯Ø®Ø§Ù„ OTP -->
        <div id="step-otp" style="display:none;">
            <div class="form-group">
                <label for="otp"><i class="fas fa-key"></i> ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (6 Ø£Ø±Ù‚Ø§Ù…)</label>
                <input type="text" id="otp" class="form-control" maxlength="6" inputmode="numeric" placeholder="______">
                <small style="color:var(--gray); display:block; margin-top:5px;">
                    <span id="verification-method-text">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span><br>
                    <a href="#" id="link-resend" style="color:var(--gold);">
                        <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ <span id="resend-countdown">60</span> Ø«Ø§Ù†ÙŠØ©)
                    </a>
                </small>
            </div>
            <button type="button" id="btn-verify-otp" class="btn btn-primary">
                <i class="fas fa-check-circle"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
            </button>
        </div>

        <!-- Ø®Ø·ÙˆØ© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ© -->
        <div id="step-case" style="display:none;">
            <div class="form-group">
                <label for="caseCode"><i class="fas fa-file-contract"></i> ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
                <input type="text" id="caseCode" class="form-control" placeholder="MA-123456" style="text-transform:uppercase;">
                <small style="color:var(--gray); display:block; margin-top:5px;">ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ</small>
            </div>
            <button type="button" id="btn-search-case" class="btn btn-primary">
                <i class="fas fa-search"></i> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©
            </button>
            
            <!-- Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù‚Ø¶ÙŠØ© Ø£Ø®Ø±Ù‰ -->
            <button type="button" id="btn-another-case" class="btn" style="width:100%; margin-top:15px; background:rgba(255,255,255,0.1); color:var(--light);">
                <i class="fas fa-plus"></i> Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù‚Ø¶ÙŠØ© Ø£Ø®Ø±Ù‰
            </button>
        </div>

        <!-- Ø¹Ø±Ø¶ OTP Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="otp-display-container" style="display:none;"></div>

        <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div id="msg-error" class="message error"></div>
        <div id="msg-success" class="message success"></div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù‚Ø¶ÙŠØ© -->
        <div id="result-box" class="result-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px;">
                <h2 style="color:var(--gold); margin:0;"><i class="fas fa-file-contract"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©</h2>
                <div>
                    <button id="btn-print" class="btn" style="background:rgba(255,255,255,0.1); color:var(--light);">
                        <i class="fas fa-file-pdf"></i> Ø·Ø¨Ø§Ø¹Ø© PDF
                    </button>
                    <button id="btn-new-case" class="btn" style="background:rgba(34,197,94,0.2); color:#4ade80; margin-right:10px;">
                        <i class="fas fa-plus"></i> Ù‚Ø¶ÙŠØ© Ø£Ø®Ø±Ù‰
                    </button>
                </div>
            </div>
            
            <div class="info-grid" id="case-info-grid">
                <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <div class="session-item" id="case-subject">
                <div class="info-label"><i class="fas fa-file-alt"></i> Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value" id="resultCaseSubject">-</div>
            </div>
            
            <h3 style="color:var(--gold); margin:25px 0 15px 0; display:flex; align-items:center; gap:10px; font-size:18px;">
                <i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            </h3>
            
            <div id="sessionsContainer">
                <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <div class="contact-section">
                <h3><i class="fas fa-headset"></i> Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø±:</h3>
                
                <div class="contact-info">
                    <a href="#" class="contact-item" onclick="openWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                        <span>Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</span>
                        <span class="contact-link">01101076000</span>
                    </a>
                    
                    <a href="#" class="contact-item" onclick="openEmail()">
                        <i class="fas fa-envelope"></i>
                        <span>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                        <span class="contact-link">ma.law.firm@outlook.com</span>
                    </a>
                    
                    <a href="#" class="contact-item" onclick="openTelegramBot()">
                        <i class="fab fa-telegram"></i>
                        <span>Telegram Bot</span>
                        <span class="contact-link">@Lawyer_OTP_Bot</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù‡Ø§Ù…Ø© -->
        <div style="background:rgba(191,149,63,0.1); padding:20px; border-radius:12px; margin-top:30px; text-align:right; border-right:3px solid var(--gold);">
            <h3 style="color:var(--gold); margin-bottom:12px; display:flex; align-items:center; gap:8px; justify-content:flex-end;">
                <i class="fas fa-info-circle"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©
            </h3>
            <ul style="list-style:none; padding:0;">
                <li style="padding:8px 0; color:var(--light); display:flex; align-items:center; gap:8px; justify-content:flex-end; font-size:14px;">
                    Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ (Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Telegram)
                </li>
                <li style="padding:8px 0; color:var(--light); display:flex; align-items:center; gap:8px; justify-content:flex-end; font-size:14px;">
                    Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯Ùƒ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
                </li>
                <li style="padding:8px 0; color:var(--light); display:flex; align-items:center; gap:8px; justify-content:flex-end; font-size:14px;">
                    ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø© ÙÙ‚Ø·
                </li>
                <li style="padding:8px 0; color:var(--light); display:flex; align-items:center; gap:8px; justify-content:flex-end; font-size:14px;">
                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø¹Ø¯Ø© Ù‚Ø¶Ø§ÙŠØ§ Ø¨Ù†ÙØ³ Ø§Ù„Ø¬Ù„Ø³Ø©
                </li>
            </ul>
        </div>
    </div>
</main>

<footer style="background:rgba(0,0,0,0.9); padding:25px 0; text-align:center; border-top:1px solid rgba(191,149,63,0.2); margin-top:40px;">
    <div class="container">
        <p style="color:var(--gray); font-size:14px;">Â© 2024 Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ù…Ø­Ø§Ù…Ø§Ø©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        <p style="color:var(--gray); font-size:14px; margin-top:8px;">
            Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 
            <a href="https://wa.me/201101076000" target="_blank" style="color:var(--gold); text-decoration:none; display:inline-flex; align-items:center; gap:6px;">
                <i class="fab fa-whatsapp"></i> 01101076000
            </a> | 
            <a href="https://t.me/Lawyer_OTP_Bot" target="_blank" style="color:var(--gold); text-decoration:none; display:inline-flex; align-items:center; gap:6px;">
                <i class="fab fa-telegram"></i> @Lawyer_OTP_Bot
            </a>
        </p>
    </div>
</footer>

<script>
// ============================================
// ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
const CONFIG = {
    SUPABASE_URL: 'https://iyhfafodhptcdwrjywek.supabase.co',
    SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5aGZhZm9kaHB0Y2R3cmp5d2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMzUzODYsImV4cCI6MjA4MjcxMTM4Nn0.YmeMSDkQ3Z_vpyMTyZ-3jbKLFzVZzwcLeDsdczrErHQ',
    EMAILJS_SERVICE: 'service_kpadqtp',
    EMAILJS_TEMPLATE: 'template_vnftwza',
    EMAILJS_PUBLIC: 'RCaH1Upo_Fep1Rorw',
    TELEGRAM_TOKEN: '8540084389:AAF3nRVjtzFwhGgLz0qryp-WCstGkeUlORU',
    OTP_EXPIRY_MIN: 15,
    RESEND_SECONDS: 60,
    OFFICE_EMAIL: 'ma.law.firm@outlook.com',
    OFFICE_PHONE: '01101076000',
    TELEGRAM_BOT: '@Lawyer_OTP_Bot'
};

// ============================================
// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
let supabaseClient = null;
let currentMethod = 'email';
let userIdentifier = '';
let userDataCache = null;
let currentOTP = null;
let currentCase = null;
let resendTimer = null;
let resendTimeLeft = 60;
let currentOTPId = null;

// ============================================
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...');
    
    // ØªÙ‡ÙŠØ¦Ø© Supabase
    try {
        supabaseClient = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
        console.log('âœ… Supabase: ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
        console.error('âŒ Supabase: ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©', error);
        showAlert('Ø®Ø·Ø£', 'ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    }
    
    // ØªÙ‡ÙŠØ¦Ø© EmailJS
    try {
        emailjs.init(CONFIG.EMAILJS_PUBLIC);
        console.log('âœ… EmailJS: ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
        console.error('âŒ EmailJS: ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©', error);
    }
    
    // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    bindEvents();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©
    checkExistingSession();
    
    console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
});

// ============================================
// Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
// ============================================
function bindEvents() {
    // Ø£Ø²Ø±Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©
    document.getElementById('method-email').addEventListener('click', () => switchMethod('email'));
    document.getElementById('method-telegram').addEventListener('click', () => switchMethod('telegram'));
    
    // Ø£Ø²Ø±Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ OTP
    document.getElementById('btn-send-email').addEventListener('click', () => sendOTP('email'));
    document.getElementById('btn-send-telegram').addEventListener('click', () => sendOTP('telegram'));
    
    // Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP
    document.getElementById('btn-verify-otp').addEventListener('click', verifyOTP);
    
    // Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©
    document.getElementById('btn-search-case').addEventListener('click', searchCase);
    
    // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ OTP
    document.getElementById('link-resend').addEventListener('click', function(e) {
        e.preventDefault();
        resendOTP();
    });
    
    // Ø²Ø± Ù‚Ø¶ÙŠØ© Ø£Ø®Ø±Ù‰
    document.getElementById('btn-another-case').addEventListener('click', showNewCaseForm);
    document.getElementById('btn-new-case').addEventListener('click', showNewCaseForm);
    
    // Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
    document.getElementById('btn-print').addEventListener('click', printPDF);
    
    // ØªÙØ¹ÙŠÙ„ Ø¥Ø¯Ø®Ø§Ù„ OTP Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€6 Ø£Ø±Ù‚Ø§Ù…
    const otpInput = document.getElementById('otp');
    otpInput.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        if (this.value.length === 6) {
            document.getElementById('btn-verify-otp').focus();
        }
    });
    
    // ØªÙØ¹ÙŠÙ„ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
    const caseInput = document.getElementById('caseCode');
    caseInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchCase();
        }
    });
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
// ============================================
function switchMethod(method) {
    console.log('ğŸ”„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰:', method);
    currentMethod = method;
    
    // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©
    document.getElementById('method-email').classList.toggle('active', method === 'email');
    document.getElementById('method-telegram').classList.toggle('active', method === 'telegram');
    
    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('step-email').style.display = method === 'email' ? 'block' : 'none';
    document.getElementById('step-telegram').style.display = method === 'telegram' ? 'block' : 'none';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('step-otp').style.display = 'none';
    document.getElementById('step-case').style.display = 'none';
    document.getElementById('result-box').style.display = 'none';
    document.getElementById('otp-display-container').style.display = 'none';
    
    hideMessages();
}

function hideMessages() {
    document.getElementById('msg-error').style.display = 'none';
    document.getElementById('msg-success').style.display = 'none';
}

function showMessage(type, text) {
    const el = document.getElementById(`msg-${type}`);
    el.textContent = text;
    el.style.display = 'block';
    console.log(`${type.toUpperCase()}:`, text);
    
    if (type === 'error') {
        console.trace('Error trace:');
    }
}

function showAlert(title, text, icon = 'info') {
    Swal.fire({
        title: title,
        text: text,
        icon: icon,
        confirmButtonColor: 'var(--gold)',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
}

function setLoading(buttonId, loading = true) {
    const btn = document.getElementById(buttonId);
    if (!btn) return;
    
    if (loading) {
        btn.classList.add('loading');
        btn.disabled = true;
    } else {
        btn.classList.remove('loading');
        btn.disabled = false;
    }
}

function startResendCountdown() {
    clearInterval(resendTimer);
    resendTimeLeft = CONFIG.RESEND_SECONDS;
    
    const link = document.getElementById('link-resend');
    const count = document.getElementById('resend-countdown');
    
    link.style.pointerEvents = 'none';
    link.style.opacity = '0.6';
    count.textContent = resendTimeLeft;
    
    resendTimer = setInterval(() => {
        resendTimeLeft--;
        count.textContent = resendTimeLeft;
        
        if (resendTimeLeft <= 0) {
            clearInterval(resendTimer);
            link.style.pointerEvents = 'auto';
            link.style.opacity = '1';
            count.textContent = '0';
        }
    }, 1000);
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©
// ============================================
function checkExistingSession() {
    try {
        const expires = localStorage.getItem('sessionExpires');
        const identifier = localStorage.getItem('userIdentifier');
        const method = localStorage.getItem('verificationMethod');
        
        if (identifier && expires && Date.now() < parseInt(expires) && method) {
            currentMethod = method;
            userIdentifier = identifier;
            userDataCache = JSON.parse(localStorage.getItem('userData') || '{}');
            
            document.getElementById('step-method').style.display = 'none';
            document.getElementById('step-email').style.display = 'none';
            document.getElementById('step-telegram').style.display = 'none';
            document.getElementById('step-otp').style.display = 'none';
            document.getElementById('step-case').style.display = 'block';
            document.getElementById('btn-another-case').style.display = 'block';
            
            showMessage('success', 'Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©.');
            console.log('âœ… Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø© ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§');
        }
    } catch (error) {
        console.error('Error checking session:', error);
    }
}

function createSession(identifier, method, userData) {
    try {
        const expires = Date.now() + (24 * 60 * 60 * 1000); // 24 Ø³Ø§Ø¹Ø©
        
        localStorage.setItem('sessionExpires', expires);
        localStorage.setItem('userIdentifier', identifier);
        localStorage.setItem('verificationMethod', method);
        localStorage.setItem('userData', JSON.stringify(userData || {}));
        
        userDataCache = userData;
        console.log('âœ… Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§');
    } catch (error) {
        console.error('Error creating session:', error);
    }
}

function isValidSession() {
    try {
        const expires = localStorage.getItem('sessionExpires');
        const identifier = localStorage.getItem('userIdentifier');
        return identifier && expires && Date.now() < parseInt(expires);
    } catch (error) {
        return false;
    }
}

// ============================================
// Ø¥Ø±Ø³Ø§Ù„ OTP
// ============================================
async function sendOTP(method) {
    console.log('ğŸ“¤ Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ OTP Ø¹Ø¨Ø±:', method);
    
    let identifier, buttonId;
    
    if (method === 'email') {
        identifier = document.getElementById('email').value.trim();
        buttonId = 'btn-send-email';
        
        if (!identifier || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(identifier)) {
            showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
            return;
        }
    } else {
        identifier = document.getElementById('telegram').value.trim();
        buttonId = 'btn-send-telegram';
        
        if (!identifier) {
            showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø£Ùˆ Chat ID');
            return;
        }
    }
    
    setLoading(buttonId, true);
    hideMessages();
    userIdentifier = identifier;
    
    try {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„:', identifier);
        const { data: casesData, error: casesError } = await supabaseClient
            .from('cases')
            .select('client_name, client_email, client_phone, case_code')
            .or(`client_email.ilike.%${identifier}%, client_phone.ilike.%${identifier}%`)
            .limit(5);
        
        if (casesError) {
            console.error('Database error:', casesError);
            throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
        if (!casesData || casesData.length === 0) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø¶Ø§ÙŠØ§ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
        console.log('âœ… ÙˆØ¬Ø¯:', casesData.length, 'Ù‚Ø¶Ø§ÙŠØ§');
        userDataCache = casesData[0];
        
        // ØªÙˆÙ„ÙŠØ¯ OTP
        const otpCode = Math.floor(100000 + Math.random() * 900000).toString();
        currentOTP = otpCode;
        console.log('ğŸ” OTP Ø§Ù„Ù…ÙˆÙ„Ø¯:', otpCode);
        
        // Ø­ÙØ¸ OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const otpRecord = {
            email: method === 'email' ? identifier : null,
            phone_number: method === 'telegram' ? identifier.replace(/\D/g, '') : null,
            otp_code: otpCode,
            expires_at: new Date(Date.now() + CONFIG.OTP_EXPIRY_MIN * 60000).toISOString(),
            is_used: false,
            created_at: new Date().toISOString()
        };
        
        console.log('ğŸ’¾ Ø­ÙØ¸ OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        const { data: insertedOTP, error: otpError } = await supabaseClient
            .from('otp_codes')
            .insert([otpRecord])
            .select()
            .single();
        
        if (otpError) {
            console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', otpError);
        } else {
            currentOTPId = insertedOTP.id;
            console.log('âœ… OTP Ù…Ø­ÙÙˆØ¸ Ø¨Ø±Ù‚Ù…:', currentOTPId);
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ OTP
        let sendResult;
        if (method === 'email') {
            console.log('ğŸ“§ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¥Ù„Ù‰:', identifier);
            sendResult = await sendEmailOTP(identifier, otpCode, userDataCache.client_name);
        } else {
            console.log('ğŸ“± Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Telegram Ø¥Ù„Ù‰:', identifier);
            sendResult = await sendTelegramOTP(identifier, otpCode, userDataCache.client_name);
        }
        
        if (sendResult.success) {
            console.log('âœ… OTP ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¨Ù†Ø¬Ø§Ø­');
            
            document.getElementById('step-email').style.display = 'none';
            document.getElementById('step-telegram').style.display = 'none';
            document.getElementById('step-otp').style.display = 'block';
            
            const methodText = method === 'email' ? 
                `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ ${identifier}` : 
                `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ø¨Ø± Telegram Ø¥Ù„Ù‰ ${identifier}`;
            document.getElementById('verification-method-text').textContent = methodText;
            
            startResendCountdown();
            showMessage('success', 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­');
            
        } else {
            console.log('âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ OTPØŒ Ø¹Ø±Ø¶ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
            displayOTPForTesting(otpCode, identifier, method, sendResult.message);
            
            document.getElementById('step-email').style.display = 'none';
            document.getElementById('step-telegram').style.display = 'none';
            document.getElementById('step-otp').style.display = 'block';
            
            const methodText = method === 'email' ? 
                `(ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±) ÙƒØ§Ù† Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ ${identifier}` : 
                `(ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±) ÙƒØ§Ù† Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ø¨Ø± Telegram Ø¥Ù„Ù‰ ${identifier}`;
            document.getElementById('verification-method-text').textContent = methodText;
            
            startResendCountdown();
            showAlert('ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 
                'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©.\nÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù….',
                'info');
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ sendOTP:', error);
        showMessage('error', error.message);
    } finally {
        setLoading(buttonId, false);
    }
}

async function sendEmailOTP(email, code, clientName) {
    try {
        const templateParams = {
            to_email: email,
            client_name: clientName || 'Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„ÙƒØ±ÙŠÙ…',
            verification_code: code,
            expiry_time: CONFIG.OTP_EXPIRY_MIN,
            office_name: "Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ù…Ø­Ø§Ù…Ø§Ø©",
            office_email: CONFIG.OFFICE_EMAIL,
            office_phone: CONFIG.OFFICE_PHONE
        };
        
        console.log('ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:', {
            service: CONFIG.EMAILJS_SERVICE,
            template: CONFIG.EMAILJS_TEMPLATE,
            params: templateParams
        });
        
        const response = await emailjs.send(
            CONFIG.EMAILJS_SERVICE,
            CONFIG.EMAILJS_TEMPLATE,
            templateParams
        );
        
        console.log('âœ… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ø±Ø³Ù„ Ø¨Ù†Ø¬Ø§Ø­:', response);
        return { success: true, message: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯' };
        
    } catch (error) {
        console.error('âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯:', error);
        return { 
            success: false, 
            message: `ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${error.text || error.message}` 
        };
    }
}

async function sendTelegramOTP(identifier, code, clientName) {
    try {
        let chatId;
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¹Ø±Ù
        const cleanId = identifier.replace(/\D/g, '');
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ù‡Ø§ØªÙ
        if (cleanId.length >= 10) {
            if (cleanId.startsWith('0')) {
                chatId = '20' + cleanId.substring(1);
            } else if (cleanId.startsWith('1') && !cleanId.startsWith('20')) {
                chatId = '20' + cleanId;
            } else if (cleanId.startsWith('20')) {
                chatId = cleanId;
            } else {
                chatId = '20' + cleanId;
            }
        } else {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† User ID
            chatId = identifier;
        }
        
        console.log('ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Telegram Ø¥Ù„Ù‰ chat_id:', chatId);
        
        const message = `
ğŸ” *Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ - Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯*

Ù…Ø±Ø­Ø¨Ø§Ù‹ ${clientName || 'Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„ÙƒØ±ÙŠÙ…'}ØŒ

Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ùˆ:
*${code}*

â° ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© ${CONFIG.OTP_EXPIRY_MIN} Ø¯Ù‚ÙŠÙ‚Ø©
ğŸ”’ Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ø¹ Ø£ÙŠ Ø£Ø­Ø¯

ğŸ›ï¸ Ù…Ø¤Ø³Ø³Ø© Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ù…Ø­Ø§Ù…Ø§Ø©
ğŸ“ ${CONFIG.OFFICE_PHONE}
        `;
        
        const response = await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'Markdown'
            })
        });
        
        const data = await response.json();
        console.log('ğŸ“± Ø±Ø¯ Telegram API:', data);
        
        if (data.ok) {
            return { success: true, message: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' };
        } else {
            let errorMsg = 'ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Telegram: ';
            if (data.description) {
                if (data.description.includes('chat not found')) {
                    errorMsg = 'Ù„Ù… ØªØ¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙˆØª. ÙŠØ±Ø¬Ù‰ Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ @Lawyer_OTP_Bot Ø£ÙˆÙ„Ø§Ù‹';
                } else if (data.description.includes('bot was blocked')) {
                    errorMsg = 'Ø§Ù„Ø¨ÙˆØª Ù…Ø­Ø¸ÙˆØ±. ÙŠØ±Ø¬Ù‰ Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± @Lawyer_OTP_Bot';
                } else {
                    errorMsg += data.description;
                }
            }
            return { success: false, message: errorMsg };
        }
        
    } catch (error) {
        console.error('âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Telegram:', error);
        return { success: false, message: 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Telegram: ' + error.message };
    }
}

function displayOTPForTesting(code, identifier, method, reason) {
    const container = document.getElementById('otp-display-container');
    const methodName = method === 'email' ? 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' : 'Telegram';
    
    container.innerHTML = `
        <div class="otp-display">
            <h3><i class="fas fa-exclamation-triangle"></i> ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)</h3>
            
            <p style="color:var(--light); margin:10px 0;">
                <i class="fas fa-info-circle"></i> 
                <strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${reason}
            </p>
            
            <p style="color:var(--gray);">
                <i class="fas fa-user"></i> 
                <strong>Ø§Ù„Ù…Ø³ØªÙ„Ù…:</strong> ${identifier}
            </p>
            
            <p style="color:var(--gray); margin-bottom:20px;">
                <i class="fas fa-${method === 'email' ? 'envelope' : 'telegram'}"></i> 
                <strong>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©:</strong> ${methodName}
            </p>
            
            <div class="code">${code}</div>
            
            <button onclick="navigator.clipboard.writeText('${code}').then(() => showMessage('success','ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯'))" 
                    style="background:rgba(191,149,63,0.2); color:var(--gold-light); border:1px solid var(--gold); 
                           padding:8px 20px; border-radius:5px; margin:15px 0; cursor:pointer; font-size:14px;">
                <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
            </button>
            
            <p style="color:var(--gold); font-size:14px; margin-top:15px;">
                <i class="fas fa-lightbulb"></i>
                ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
            </p>
        </div>
    `;
    container.style.display = 'block';
}

async function resendOTP() {
    if (resendTimeLeft > 0) {
        showMessage('error', `ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ${resendTimeLeft} Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„`);
        return;
    }
    
    if (!userIdentifier) {
        showMessage('error', 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù…');
        return;
    }
    
    try {
        const otpCode = Math.floor(100000 + Math.random() * 900000).toString();
        currentOTP = otpCode;
        
        const otpRecord = {
            email: currentMethod === 'email' ? userIdentifier : null,
            phone_number: currentMethod === 'telegram' ? userIdentifier.replace(/\D/g, '') : null,
            otp_code: otpCode,
            expires_at: new Date(Date.now() + CONFIG.OTP_EXPIRY_MIN * 60000).toISOString(),
            is_used: false,
            created_at: new Date().toISOString()
        };
        
        const { data: insertedOTP, error: otpError } = await supabaseClient
            .from('otp_codes')
            .insert([otpRecord])
            .select()
            .single();
        
        if (!otpError) {
            currentOTPId = insertedOTP.id;
        }
        
        let sendResult;
        if (currentMethod === 'email') {
            sendResult = await sendEmailOTP(userIdentifier, otpCode, userDataCache?.client_name);
        } else {
            sendResult = await sendTelegramOTP(userIdentifier, otpCode, userDataCache?.client_name);
        }
        
        if (sendResult.success) {
            startResendCountdown();
            showMessage('success', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚');
        } else {
            displayOTPForTesting(otpCode, userIdentifier, currentMethod, 'ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + sendResult.message);
            startResendCountdown();
            showAlert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', 
                'ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.',
                'info');
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ resendOTP:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
    }
}

// ============================================
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP
// ============================================
async function verifyOTP() {
    const enteredCode = document.getElementById('otp').value.trim();
    
    if (!enteredCode || enteredCode.length !== 6 || !/^\d{6}$/.test(enteredCode)) {
        showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØªØ­Ù‚Ù‚ Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…');
        return;
    }
    
    setLoading('btn-verify-otp', true);
    
    try {
        console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP:', enteredCode);
        
        let query = supabaseClient
            .from('otp_codes')
            .select('*')
            .eq('otp_code', enteredCode)
            .eq('is_used', false)
            .gt('expires_at', new Date().toISOString())
            .order('created_at', { ascending: false })
            .limit(1);
        
        if (currentMethod === 'email') {
            query = query.eq('email', userIdentifier);
        } else {
            query = query.eq('phone_number', userIdentifier.replace(/\D/g, ''));
        }
        
        const { data: otpData, error: otpError } = await query.single();
        
        if (otpError || !otpData) {
            console.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ OTP ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø­Ù„ÙŠØ§Ù‹');
            
            if (enteredCode === currentOTP) {
                console.log('âœ… OTP ØµØ­ÙŠØ­ (ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±)');
            } else {
                showMessage('error', 'ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©');
                setLoading('btn-verify-otp', false);
                return;
            }
        } else {
            console.log('âœ… OTP ØµØ­ÙŠØ­ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            await supabaseClient
                .from('otp_codes')
                .update({ is_used: true })
                .eq('id', otpData.id);
        }
        
        createSession(userIdentifier, currentMethod, userDataCache);
        
        document.getElementById('step-otp').style.display = 'none';
        document.getElementById('step-case').style.display = 'block';
        document.getElementById('btn-another-case').style.display = 'block';
        document.getElementById('otp-display-container').style.display = 'none';
        
        showMessage('success', 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù‚Ø¶ÙŠØªÙƒ');
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ verifyOTP:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚');
    } finally {
        setLoading('btn-verify-otp', false);
    }
}

// ============================================
// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©
// ============================================
async function searchCase() {
    if (!isValidSession()) {
        showMessage('error', 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
        resetToFirstStep();
        return;
    }
    
    const caseCode = document.getElementById('caseCode').value.trim().toUpperCase();
    
    if (!caseCode) {
        showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©');
        return;
    }
    
    setLoading('btn-search-case', true);
    
    try {
        console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ©:', caseCode);
        
        const { data: caseData, error: caseError } = await supabaseClient
            .from('cases')
            .select(`
                *,
                sessions (*)
            `)
            .eq('case_code', caseCode)
            .single();
        
        if (caseError || !caseData) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø¶ÙŠØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯');
        }
        
        console.log('âœ… ÙˆØ¬Ø¯Øª Ø§Ù„Ù‚Ø¶ÙŠØ©:', caseData.case_code);
        
        currentCase = caseData;
        displayCaseDetails(caseData);
        document.getElementById('btn-another-case').style.display = 'block';
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ searchCase:', error);
        showMessage('error', error.message);
    } finally {
        setLoading('btn-search-case', false);
    }
}

// ============================================
// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©
// ============================================
function displayCaseDetails(caseData) {
    try {
        const infoGrid = document.getElementById('case-info-grid');
        
        infoGrid.innerHTML = `
            <div class="info-item">
                <div class="info-label"><i class="fas fa-hashtag"></i> ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value">${caseData.case_code || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value">${caseData.case_number || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-calendar"></i> Ø³Ù†Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</div>
                <div class="info-value">${caseData.case_year || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div class="info-value">${caseData.client_name || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user-tag"></i> ØµÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div class="info-value">${caseData.client_role || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-user-friends"></i> Ø§Ø³Ù… Ø§Ù„Ø®ØµÙ…</div>
                <div class="info-value">${caseData.opponent_name || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-gavel"></i> Ø§Ù„Ù…Ø­ÙƒÙ…Ø©</div>
                <div class="info-value">${caseData.court || '-'}</div>
            </div>
            
            <div class="info-item">
                <div class="info-label"><i class="fas fa-balance-scale"></i> Ø§Ù„Ø­Ø§Ù„Ø©</div>
                <div class="info-value">${caseData.status || '-'}</div>
            </div>
        `;
        
        document.getElementById('resultCaseSubject').textContent = caseData.subject || '-';
        
        const sessionsContainer = document.getElementById('sessionsContainer');
        if (caseData.sessions && caseData.sessions.length > 0) {
            const sortedSessions = [...caseData.sessions].sort((a, b) => 
                new Date(b.session_date) - new Date(a.session_date)
            );
            
            let sessionsHTML = '';
            sortedSessions.forEach(session => {
                const sessionDate = new Date(session.session_date);
                const formattedDate = sessionDate.toLocaleDateString('ar-EG', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                sessionsHTML += `
                    <div class="session-item">
                        <div style="color:var(--gold); font-weight:bold; margin-bottom:8px; display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-calendar-day"></i>
                            ${formattedDate}
                        </div>
                        <div style="color:var(--light); margin-bottom:5px;">
                            <i class="fas fa-info-circle"></i> Ø§Ù„Ù‚Ø±Ø§Ø±: ${session.decision || 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø±'}
                        </div>
                        ${session.notes ? `<div style="color:var(--gray); font-size:14px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${session.notes}</div>` : ''}
                    </div>
                `;
            });
            
            sessionsContainer.innerHTML = sessionsHTML;
        } else {
            sessionsContainer.innerHTML = `
                <div class="session-item">
                    <div style="color:var(--gray); text-align:center; padding:15px;">
                        <i class="fas fa-calendar-times"></i>
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ø¹Ø¯
                    </div>
                </div>
            `;
        }
        
        document.getElementById('result-box').style.display = 'block';
        
        setTimeout(() => {
            document.getElementById('result-box').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }, 300);
        
        showMessage('success', 'ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ displayCaseDetails:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©');
    }
}

// ============================================
// Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ©
// ============================================
function showNewCaseForm() {
    document.getElementById('caseCode').value = '';
    document.getElementById('result-box').style.display = 'none';
    document.getElementById('step-case').style.display = 'block';
    document.getElementById('caseCode').focus();
    document.getElementById('btn-another-case').style.display = 'block';
    showMessage('success', 'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©');
}

function resetToFirstStep() {
    document.getElementById('step-method').style.display = 'block';
    document.getElementById('step-email').style.display = 'block';
    document.getElementById('step-telegram').style.display = 'none';
    document.getElementById('step-otp').style.display = 'none';
    document.getElementById('step-case').style.display = 'none';
    document.getElementById('result-box').style.display = 'none';
    document.getElementById('otp-display-container').style.display = 'none';
    document.getElementById('btn-another-case').style.display = 'none';
    
    document.getElementById('email').value = '';
    document.getElementById('telegram').value = '';
    document.getElementById('otp').value = '';
    document.getElementById('caseCode').value = '';
    
    userIdentifier = '';
    currentOTP = null;
    currentCase = null;
    userDataCache = null;
    currentOTPId = null;
    
    localStorage.removeItem('sessionExpires');
    localStorage.removeItem('userIdentifier');
    localStorage.removeItem('verificationMethod');
    localStorage.removeItem('userData');
    
    clearInterval(resendTimer);
}

function printPDF() {
    if (!currentCase) {
        showMessage('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
        return;
    }
    
    showAlert('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù…ÙŠØ²Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
}

function openWhatsApp() {
    const message = currentCase ? 
        `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØªÙŠ Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯: ${currentCase.case_code}` :
        'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©';
    window.open(`https://wa.me/201101076000?text=${encodeURIComponent(message)}`, '_blank');
}

function openEmail() {
    const subject = currentCase ? 
        `Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù‚Ø¶ÙŠØ© ${currentCase.case_code}` :
        'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©';
    const body = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ\n\nØ£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‚Ø¶ÙŠØ©\n\nÙ…Ø¹ Ø§Ù„Ø´ÙƒØ±`;
    window.location.href = `mailto:${CONFIG.OFFICE_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

function openTelegramBot() {
    window.open(`https://t.me/${CONFIG.TELEGRAM_BOT.substring(1)}`, '_blank');
}

// ============================================
// Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================
function testSystem() {
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ - Ø§Ù„Ø¥ØµØ¯Ø§Ø±     â•‘
â•‘â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•‘
â•‘ âœ… Supabase: ${supabaseClient ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}            â•‘
â•‘ âœ… EmailJS: ${window.emailjs ? 'Ù…Ù‡ÙŠØ£' : 'ØºÙŠØ± Ù…Ù‡ÙŠØ£'}           â•‘
â•‘ âœ… Telegram Bot: ${CONFIG.TELEGRAM_TOKEN ? 'Ø¬Ø§Ù‡Ø²' : 'ØºÙŠØ± Ø¬Ø§Ù‡Ø²'}    â•‘
â•‘ âœ… Ø§Ù„ØªØµÙ…ÙŠÙ…: ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„                  â•‘
â•‘ âœ… Ø§Ù„Ù†Ø¸Ø§Ù…: Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `);
}

// ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
setTimeout(testSystem, 1000);
</script>
</body>
</html>
